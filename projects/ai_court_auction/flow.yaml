# AI 법원 경매 사업계획서 - 워크플로우 정의
# 생성일: 2026-02-06
# 용도: 정부지원 사업계획서 자동 작성

name: "AI 법원 경매 사업계획서"
version: 1
description: "AI 기반 법원 경매 물건 분석 솔루션 사업계획서 작성"

# ══════════════════════════════════════════════════════════════
# 탭 구성 (5-Tab 시스템)
# ══════════════════════════════════════════════════════════════
tabs:
  research:
    tab: 1
    name: "리서치"
    mode: deep_research
    purpose: "시장조사, 통계, 경쟁분석"
    env_var: TAB_RESEARCH

  writer_champion:
    tab: 2
    name: "Writer (Champion)"
    mode: normal
    purpose: "고정 프롬프트로 사업계획서 작성"
    section_aware: true
    env_var: TAB_WRITER_CHAMPION

  writer_challenger:
    tab: 3
    name: "Writer (Challenger)"
    mode: normal
    purpose: "개선 프롬프트로 사업계획서 작성"
    section_aware: true
    env_var: TAB_WRITER_CHALLENGER

  evaluator:
    tab: 4
    name: "Evaluator (Frozen)"
    mode: new_chat
    purpose: "사업계획서 평가 (매번 새 채팅)"
    env_var: TAB_EVALUATOR

  critic:
    tab: 5
    name: "Prompt Critic"
    mode: normal
    purpose: "프롬프트 개선 및 피드백"
    section_aware: true
    env_var: TAB_CRITIC

# ══════════════════════════════════════════════════════════════
# 변수 정의
# ══════════════════════════════════════════════════════════════
variables:
  topic:
    description: "사업 주제"
    default: "AI 기반 법원 경매 물건 분석 및 투자 추천 솔루션"

  section_id:
    description: "섹션 ID (s1_1, s1_2, ...)"
    required: true

  section_name:
    description: "섹션 이름"
    required: true

  pages:
    description: "분량 (페이지)"
    default: "1.5"

  research_type:
    description: "리서치 유형"
    options:
      - market_size
      - competitive
      - customer_needs

# ══════════════════════════════════════════════════════════════
# 워크플로우 단계
# ══════════════════════════════════════════════════════════════
steps:
  # 1단계: 시장 리서치 (선택적)
  - id: research
    name: "시장 리서치"
    tab: research
    enabled: false  # --research 옵션으로 활성화
    prompt: "research/prompts/{research_type}.md"
    output: "research/{research_type}.md"
    timeout: 300
    cache: true

  # 2단계: 사업계획서 작성
  - id: write
    name: "사업계획서 작성"
    tab: writer_champion  # 또는 writer_challenger
    prompt: "prompts/writer/champion.md"
    variables:
      - topic
      - section_name
      - section_id
      - pages
    inject:
      - source: "$research.output"
        condition: "$research.enabled"
        label: "심층 리서치 결과"
    output: "outputs/{section_id}_draft.md"
    timeout: 180
    retry: 3

  # 3단계: 평가
  - id: evaluate
    name: "평가"
    tab: evaluator
    prompt: "prompts/evaluator/frozen.md"
    input: "$write.output"
    output: "outputs/{section_id}_eval.json"
    timeout: 120
    retry: 3
    parse: json

  # 4단계: 프롬프트 개선 (조건부)
  - id: improve
    name: "프롬프트 개선"
    tab: critic
    condition: "$evaluate.score < 85"
    prompt: "prompts/critic/improve.md"
    input:
      - "$write.output"
      - "$evaluate.output"
    output: "prompts/challenger/v{iteration}.md"
    timeout: 90

# ══════════════════════════════════════════════════════════════
# 설정
# ══════════════════════════════════════════════════════════════
settings:
  # ChatGPT 프로젝트 URL
  project_url: "https://chatgpt.com/g/g-p-69847ea187ec81919c424d62ee85ea25-plan"

  # 기본 타임아웃
  default_timeout: 90

  # 재시도 설정
  retry:
    max_attempts: 3
    delay: 2
    new_chat_on_fail: true

  # 출력 디렉토리
  output_dir: "outputs"

  # 로그 레벨
  log_level: "info"

# ══════════════════════════════════════════════════════════════
# 섹션 정의 (사업계획서 구조)
# ══════════════════════════════════════════════════════════════
sections:
  - id: s1_1
    name: "1-1. 창업아이템 개요"
    pages: 1.0

  - id: s1_2
    name: "1-2. 창업아이템 배경 및 필요성"
    pages: 1.5
    research_type: market_size

  - id: s1_3
    name: "1-3. 창업아이템 목표시장(고객) 현황 분석"
    pages: 2.0
    research_type: competitive

  - id: s1_4
    name: "1-4. 창업아이템 실현 및 구체화 방안"
    pages: 1.5

  - id: s2_1
    name: "2-1. 기술개발 전략"
    pages: 1.5

  - id: s2_2
    name: "2-2. 기술개발 내용 및 추진계획"
    pages: 2.0

  - id: s3_1
    name: "3-1. 비즈니스 모델 및 사업화 추진성과"
    pages: 1.5

  - id: s3_2
    name: "3-2. 사업화 역량"
    pages: 1.0
