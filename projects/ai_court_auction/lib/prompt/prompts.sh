#!/bin/bash
# prompts.sh - ChatGPT 프롬프트 템플릿 (한국어)

# ══════════════════════════════════════════════════════════════
# 시스템 컨텍스트 (세션 시작 시 1회 전송)
# ══════════════════════════════════════════════════════════════

prompt_system_context() {
    local topic="$1"
    cat <<PROMPT
당신은 한국 중소벤처기업부의 "재도전성공패키지" 사업계획서 작성 전문 컨설턴트입니다.

[역할]
- 정부지원사업 사업계획서 심사위원 경험 10년 이상의 전문가
- 재창업 기업의 성공적인 사업계획서 작성을 돕는 것이 목표

[작성 주제]
${topic}

[핵심 규칙]
1. 사업계획서는 목차 제외 15페이지 이내
2. 개인정보(성명, 성별, 생년월일, 학교명 등)는 반드시 마스킹 처리 (○, * 사용)
3. 파란색 안내 문구는 삭제하고 검정 글씨로 실제 내용 작성
4. 구체적 수치, 근거, 데이터를 활용하여 설득력 있게 작성
5. 각 섹션은 심사위원이 평가하는 핵심 포인트를 반드시 포함

앞서 업로드한 PDF 양식을 참고하여, 제가 섹션별로 요청하면 해당 섹션을 작성해주세요.
각 섹션 작성 시 이전 섹션과의 일관성을 유지해주세요.

준비되었으면 "준비 완료"라고 답해주세요.
PROMPT
}

# ══════════════════════════════════════════════════════════════
# 섹션 작성 프롬프트
# ══════════════════════════════════════════════════════════════

prompt_draft() {
    local section_id="$1"
    local topic="$2"
    local prior_summary="$3"
    local research_data="$4"

    local section_name
    section_name=$(get_section_name "$section_id")
    local pages
    pages=$(get_section_pages "$section_id")
    local section_detail
    section_detail=$(get_section_detail "$section_id")

    cat <<PROMPT
[사업계획서 섹션 작성 요청]

주제: ${topic}
PROMPT

    # 이전 섹션 요약이 있으면 포함
    if [[ -n "$prior_summary" ]]; then
        cat <<PROMPT

[이전 섹션 요약]
${prior_summary}
PROMPT
    fi

    cat <<PROMPT

[작성할 섹션] ${section_name}

[세부 작성 지침]
${section_detail}

[분량] 약 ${pages}페이지 분량 (A4 기준)
PROMPT

    # 리서치 데이터가 있으면 포함
    if [[ -n "$research_data" ]]; then
        cat <<PROMPT

[참고 리서치 데이터]
${research_data}
PROMPT
    fi

    cat <<PROMPT

[요청사항] ★ 정부 과제 제출용 완성 문서로 작성 ★
1. 위 양식의 세부 항목을 빠짐없이 포함하여 작성
2. 구체적 수치와 근거(출처 포함)를 제시
3. 심사위원 관점에서 설득력 있는 논리 전개
4. 표는 반드시 마크다운 형식으로 작성 (| 헤더1 | 헤더2 | ... | + |---|---|)
5. 해당 섹션만 작성하고, 다른 섹션 내용은 포함하지 마세요

[금지사항] ★ 중요 ★
- AI 제안/코멘트 금지 ("원하시면", "추가로", "참고로" 등 비공식 표현 금지)
- 미완성 표현 금지 ("~할 수 있습니다", "~하면 좋겠습니다")
- 본문 외 추가 설명 금지 (바로 제출 가능한 완성형만 출력)

[사용자 입력 필요 항목 식별] ★ 필수 ★
위 섹션을 작성하면서 "사용자(대표자)만 알 수 있는 실제 정보"가 필요한 부분이 있으면,
본문 작성 후 아래 형식으로 별도 출력해주세요:

USER_INPUT_NEEDED:
- Q1: {질문 내용}
  예시: {성공한 사업계획서에서 작성한 예시 답변 1~2문장}
- Q2: {질문 내용}
  예시: {성공한 사업계획서에서 작성한 예시 답변 1~2문장}
(필요한 만큼 추가)

※ 사용자 입력이 필요 없으면 "USER_INPUT_NEEDED: 없음" 으로 출력
PROMPT
}

# ══════════════════════════════════════════════════════════════
# 섹션별 세부 작성 지침
# ══════════════════════════════════════════════════════════════

get_section_detail() {
    local section_id="$1"

    case "$section_id" in
        "overview")
            cat <<'DETAIL'
신청현황과 일반현황을 작성합니다.
- 신청 주관기관명, 신청구분(예비재창업자/재창업기업), 사업분야(제조/지식서비스/융합), 기술분야 선택
- 사업비 구성계획: 정부지원(최대 1억원, 총사업비 75% 이하), 자기부담(현금 5% 이상, 현물 20% 이하)
- 창업아이템명: "OO기술이 적용된 OO기능의 (혜택을 제공하는) OO제품·서비스" 형식
- 산출물(협약기간 내 목표), 기업구성 현황 표
- 폐업기업 현황 표 (개업일, 폐업일, 기업구분)
DETAIL
            ;;
        "product_summary")
            cat <<'DETAIL'
아이템 개요(요약) 페이지를 작성합니다. 다음 4개 항목을 포함:
- 아이템 개요: 핵심기능, 소비자층, 사용처 중심으로 간략 소개
- 배경 및 필요성: 개발 배경, 경쟁 제품 대비 차별성
- 현황 및 구체화 방안: 개발 현황, 협약기간 내 고도화 계획
- 목표시장 및 사업화 전략: 국내외 목표시장 진출 현황/계획, 비즈니스 모델
- 이미지: [이미지 삽입 위치] 표시
DETAIL
            ;;
        "closure_details")
            cat <<'DETAIL'
폐업기업 세부내용을 작성합니다.
- 기업명, 사업장 소재지, 개업/회사성립 연월일, 기업구분
- 운영기간, 아이템명, 아이템 개요
- 사업분야(제조/지식서비스/기타), 기술분야 선택
- 폐업 원인 및 사유: 간략하되 구체적으로 작성
※ 이 섹션은 사용자의 실제 폐업 경험이 필요합니다. 예시를 기반으로 초안을 작성하되,
   사용자가 수정할 수 있도록 [사용자 확인 필요] 표시를 해주세요.
DETAIL
            ;;
        "s1_1")
            cat <<'DETAIL'
1-1. 폐업 원인 분석 및 개선방안을 작성합니다. 3개 하위 항목 포함:
□ 폐업기업 사업개요: 이전 사업의 아이템, 사업모델 개요
□ 폐업 원인 분석 (외적, 내적 요인):
  - 외적: 시장 변화, 법적 규제, 환경 변화 등
  - 내적: 기업 역량, 경영 전략, 기술성 부족 등
□ 폐업 원인에 대한 개선 방안: 재창업에서 어떻게 극복할 것인지
※ 폐업 경험의 반성과 학습을 보여주는 것이 핵심 평가 포인트입니다.
※ [사용자 확인 필요] 표시를 포함해주세요.
DETAIL
            ;;
        "s1_2")
            cat <<'DETAIL'
1-2. 창업아이템 배경 및 필요성을 작성합니다.
- ①외부적 배경 및 동기: 사회·경제·기술적 관점, 시장의 문제점·기회
- ②내부적 배경 및 동기: 대표자 경험, 가치관, 비전
- 배경에서 발견한 문제점과 해결방안
- 제품·서비스 개선/고도화 또는 신규 출시 목적
- 제품·서비스의 유망성, 성장가능성 논증
DETAIL
            ;;
        "s1_3")
            cat <<'DETAIL'
1-3. 창업아이템 목표시장(고객) 현황 분석을 작성합니다.
- 목표시장(고객) 설정: TAM/SAM/SOM 프레임워크 활용
- 시장 규모·상황·특성, 경쟁 강도, 향후 전망(성장성)
- 고객 특성 및 세분화
- 기존 경쟁자 분석 (고객 관점에서)
- 목표시장(고객) 요구사항 조사·분석 결과 및 객관적 근거
※ 이 섹션은 구체적 시장 데이터가 필수입니다. 리서치 데이터를 활용해주세요.
DETAIL
            ;;
        "s2_1")
            cat <<'DETAIL'
2-1. 창업아이템 현황 (준비 정도)를 작성합니다.
- 신청 이전까지 기획·추진한 경과(이력)
- 제품·서비스 개발/개선 단계별 현황 (TRL 레벨 등)
- 목표 시장(고객)의 반응
- 현재까지의 주요 사업화 성과
DETAIL
            ;;
        "s2_2")
            cat <<'DETAIL'
2-2. 창업아이템의 실현 및 구체화 방안을 작성합니다.
- 핵심 기능·성능 개발/개선 방안
- 디자인 개선 방안
- 목표시장(고객) 요구사항 분석 → 개선 및 대응 방안
- 경쟁사 대비 차별성 및 경쟁력 확보 방안 (보유 역량 기반)
- 기술 보호 계획 (특허, 영업비밀 등)
DETAIL
            ;;
        "s3_1")
            cat <<'DETAIL'
3-1. 비즈니스 모델 및 사업화 추진성과를 작성합니다.
- 수익모델 (비즈니스 모델) 상세 기술
- 목표시장(고객) 진입 현황
- 사업화 추진성과 (매출, 투자, 고용)
- 매출 실적 표 작성: 순번, 목표시장, 제품·서비스, 진입시기, 판매량, 가격, 판매금액
※ 아직 매출이 없는 경우 무료 다운로드, 회원가입 등 성과 지표 활용
DETAIL
            ;;
        "s3_2")
            cat <<'DETAIL'
3-2. 사업화 추진 전략을 작성합니다.
- 세부 고객·경쟁사·대체 제품 분석 기반 시장 진입 전략
- 고객 확보·확장 전략, 수익 확대 전략
  (생산·출시, 홍보·마케팅, 유통·판매, 인력·네트워크)
- 협약기간 내 사업화 성과 목표 (매출, 투자, 고용)
- 협약기간 종료 후 성과 창출 전략
- 추정 매출 표: 순번, 목표시장, 제품·서비스, 진출시기, 판매량, 가격, 판매금액
DETAIL
            ;;
        "s3_3")
            cat <<'DETAIL'
3-3. 사업추진 일정 및 자금운용 계획을 작성합니다.
3-3-1. 사업 전체 로드맵: 종합 목표, 추진 일정 표
3-3-2. 협약기간(25.4~10월) 내 목표 및 달성 방안: 월별 추진 일정 표
3-3-3. 사업비 집행계획:
  - 정부지원(최대 1억원, 총사업비 75% 이하)
  - 자기부담 현금(5% 이상), 현물(20% 이하)
  - 비목별 산출근거 표 (재료비, 외주용역비 등)
3-3-4. 자금 필요성 및 조달계획:
  - 기존 자금 조달 이력
  - 자기부담금 조달 방안
  - 투자유치 계획 (Seed, 시리즈A 등)
DETAIL
            ;;
        "s4_1")
            cat <<'DETAIL'
4-1. 기업구성 및 보유 역량을 작성합니다.
4-1-1. 대표자 및 기업 현황:
  - 대표자 역량 (경영능력, 경력·학력, 기술력, 노하우, 네트워크)
  - 보유 장비·시설, 직원 역량
  - 재직 인력 고용현황 표
  ※ 개인정보 마스킹 필수
4-1-2. 협약기간 내 인력 고용 및 활용 계획:
  - 추가 고용 계획 표 (담당업무, 요구역량, 채용시기)
4-1-3. 외부 협력 현황 및 활용 방안:
  - 파트너명, 보유역량, 협업방안, 협력시기 표
※ [사용자 확인 필요] 표시 포함
DETAIL
            ;;
        "s4_2")
            cat <<'DETAIL'
4-2. ESG 경영 도입 현황 또는 계획을 작성합니다.
- 환경(E): 폐기물 감소, 재활용, 친환경 원료, 에너지 절감
- 사회(S): 지역사회 교류, 사회 환원, 인권, 평등, 다양성
- 지배구조(G): 윤리경영, 상호 존중 조직문화, 근로환경 개선
※ 분량은 약 0.5페이지로 간결하게 작성
DETAIL
            ;;
        *)
            echo "섹션 작성 지침을 참고하여 작성해주세요."
            ;;
    esac
}

# ══════════════════════════════════════════════════════════════
# 평가 프롬프트
# ══════════════════════════════════════════════════════════════

prompt_verify() {
    local section_id="$1"
    local section_content="$2"

    local section_name
    section_name=$(get_section_name "$section_id")

    cat <<PROMPT
[사업계획서 섹션 평가 요청]

다음은 "재도전성공패키지" 사업계획서의 "${section_name}" 섹션입니다.

--- 작성된 내용 ---
${section_content}
--- 끝 ---

**평가 기준: 정부 과제 수주에 성공한 사업계획서 수준**
당신은 정부 과제 심사위원입니다. 실제로 선정되어 자금을 받은 우수 사업계획서 기준으로 엄격하게 평가하세요.

[내용 평가 (80점)]
1. 완성도 (20점): 양식의 모든 필수 항목을 빠짐없이 포함했는가
2. 구체성 (20점): 수치, 데이터, 출처가 구체적인가 (모호한 표현 없는가)
3. 논리성 (20점): 논리적 흐름이 자연스럽고 설득력이 있는가
4. 차별성 (20점): 경쟁 서비스 대비 명확한 우위가 있는가

[형식 평가 (20점)]
5. 제출 완성도 (10점):
   - AI 제안/코멘트가 포함되어 있으면 -10점
   - "원하시면", "추가로", "참고로" 등 비공식 표현 포함 시 -5점
6. 문서 형식 (10점):
   - 표가 마크다운 형식(|---|---|)으로 올바르게 작성되었는가
   - 줄바꿈, 문단 구분이 적절한가

[출력 형식] 반드시 아래 형식으로 출력해주세요:
SCORE: [총점]/100
BREAKDOWN: 완성도=[점수], 구체성=[점수], 논리성=[점수], 차별성=[점수], 제출완성도=[점수], 문서형식=[점수]
STRENGTHS:
- [강점 1]
- [강점 2]
WEAKNESSES:
- [약점 1 + 구체적 개선 방안]
- [약점 2 + 구체적 개선 방안]
FORMAT_ISSUES:
- [형식 문제점 (있으면)]
PRIORITY_FIX: [가장 먼저 개선해야 할 1가지]
PROMPT
}

# ══════════════════════════════════════════════════════════════
# 재작성 프롬프트
# ══════════════════════════════════════════════════════════════

prompt_rewrite() {
    local section_id="$1"
    local section_content="$2"
    local feedback="$3"

    local section_name
    section_name=$(get_section_name "$section_id")

    cat <<PROMPT
[사업계획서 섹션 재작성 요청]

"${section_name}" 섹션을 아래 피드백을 반영하여 재작성해주세요.

--- 현재 내용 ---
${section_content}
--- 끝 ---

--- 평가 피드백 ---
${feedback}
--- 끝 ---

[재작성 지침]
1. 피드백의 PRIORITY_FIX 항목을 최우선으로 개선
2. WEAKNESSES에 명시된 모든 약점을 보완
3. STRENGTHS의 강점은 유지하면서 개선
4. 분량은 기존과 비슷하게 유지 (15페이지 제한 고려)
5. 전체 내용을 재작성하여 출력 (수정된 부분만이 아닌 전체)
PROMPT
}

# ══════════════════════════════════════════════════════════════
# 심층 리서치 프롬프트
# ══════════════════════════════════════════════════════════════

prompt_research() {
    local topic="$1"
    local research_type="$2"

    case "$research_type" in
        "market_size")
            cat <<PROMPT
다음 주제에 대한 시장 조사를 해주세요: "${topic}"

조사 항목:
1. 국내 시장 규모 (최근 3년 추이, 향후 5년 전망, CAGR)
2. 글로벌 시장 규모 및 한국 비중
3. 주요 경쟁사 현황 (국내 3-5개, 해외 2-3개) - 각각 매출, 시장점유율, 주요 제품
4. 목표 고객 세그먼트별 규모 및 특성
5. 관련 정부 정책, 규제 동향
6. 기술 트렌드 및 시장 진입 장벽

모든 수치에 출처를 명시해주세요. 출처가 불분명한 경우 "추정"이라고 표기해주세요.
PROMPT
            ;;
        "competitive")
            cat <<PROMPT
다음 분야의 경쟁 환경을 분석해주세요: "${topic}"

분석 항목:
1. 직접 경쟁사 (동일 제품/서비스): 각 기업의 강점, 약점, 시장점유율
2. 간접 경쟁사 (대체 솔루션): 어떤 방식으로 동일 문제를 해결하는지
3. 잠재 진입자: 대기업, 스타트업 동향
4. 경쟁사 가격 전략 비교
5. 차별화 가능 포인트
6. Porter의 5 Forces 분석

정량적 데이터를 최대한 포함해주세요.
PROMPT
            ;;
        "customer_needs")
            cat <<PROMPT
다음 제품/서비스의 잠재 고객 요구사항을 조사해주세요: "${topic}"

조사 항목:
1. 고객이 현재 겪고 있는 주요 불편/문제점 (Pain Points)
2. 기존 대안 솔루션과 그 한계점
3. 고객이 원하는 이상적인 솔루션의 요건
4. 가격 민감도 및 지불 의향 (WTP)
5. 고객 획득 채널 및 구매 의사결정 과정
6. 관련 설문조사, 리포트 데이터

수치와 출처를 최대한 포함해주세요.
PROMPT
            ;;
        *)
            echo "주제: ${topic}에 대한 심층 조사를 수행해주세요."
            ;;
    esac
}

# ══════════════════════════════════════════════════════════════
# 사용자 입력 템플릿 생성 프롬프트
# ══════════════════════════════════════════════════════════════

prompt_generate_input_template() {
    local section_id="$1"
    local section_name
    section_name=$(get_section_name "$section_id")

    cat <<PROMPT
[사용자 입력 템플릿 생성 요청]

"${section_name}" 섹션 작성을 위해 사용자(대표자)에게 받아야 할 정보를 정리해주세요.

[출력 형식]
각 질문에 대해 아래 형식으로 출력:

## Q1. {질문 제목}
{상세 질문 내용}

| 항목 | 답변 (직접 작성) |
|------|------------------|
| {항목1} | |
| {항목2} | |

**[예시 - 성공 사업계획서]**
| 항목 | 답변 |
|------|------|
| {항목1} | {예시 답변1} |
| {항목2} | {예시 답변2} |

---

[요구사항]
1. 질문은 구체적이고 명확하게
2. 예시는 실제 성공한 사업계획서 수준으로 상세하게
3. 표 형식으로 답변하기 쉽게 구성
4. 사용자가 바로 채워넣을 수 있는 형태로
PROMPT
}

# ══════════════════════════════════════════════════════════════
# 일관성 검토 프롬프트
# ══════════════════════════════════════════════════════════════

prompt_consistency_check() {
    local section_a_name="$1"
    local section_a_content="$2"
    local section_b_name="$3"
    local section_b_content="$4"

    cat <<PROMPT
다음 두 섹션 간의 일관성을 검토해주세요.

[섹션 A: ${section_a_name}]
${section_a_content}

[섹션 B: ${section_b_name}]
${section_b_content}

[검토 항목]
1. 수치의 일관성 (시장 규모, 매출 전망, 사업비 등)
2. 용어의 일관성 (제품명, 시장명, 기술명 등)
3. 논리적 연결 (A에서 언급한 내용이 B에서 모순되지 않는지)
4. 시간표 일관성 (일정, 기간 등)

불일치 발견 시 구체적으로 명시하고 수정 제안을 해주세요.
형식: CONSISTENT: YES/NO
(NO인 경우) ISSUES: [불일치 목록]
PROMPT
}
