#!/bin/bash
# create_project.sh - ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±
# ì‚¬ìš©ë²•: ./create_project.sh <project_name>
#
# ì˜ˆì‹œ:
#   ./create_project.sh marketing_report
#   ./create_project.sh research_assistant

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECTS_DIR="${SCRIPT_DIR}/projects"
TEMPLATES_DIR="${SCRIPT_DIR}/core/templates"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì‚¬ìš©ë²• ì¶œë ¥
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
usage() {
    echo "ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±"
    echo ""
    echo "ì‚¬ìš©ë²•: $0 <project_name>"
    echo ""
    echo "ì˜ˆì‹œ:"
    echo "  $0 marketing_report"
    echo "  $0 research_assistant"
    echo ""
    echo "ìƒì„±ë˜ëŠ” êµ¬ì¡°:"
    echo "  projects/<project_name>/"
    echo "  â”œâ”€â”€ config.sh        # í”„ë¡œì íŠ¸ ì„¤ì •"
    echo "  â”œâ”€â”€ flow.yaml        # ì›Œí¬í”Œë¡œìš° ì •ì˜"
    echo "  â”œâ”€â”€ run.sh           # ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸"
    echo "  â”œâ”€â”€ prompts/         # í”„ë¡¬í”„íŠ¸ íŒŒì¼ë“¤"
    echo "  â”‚   â”œâ”€â”€ writer/"
    echo "  â”‚   â””â”€â”€ evaluator/"
    echo "  â”œâ”€â”€ outputs/         # ì¶œë ¥ íŒŒì¼"
    echo "  â””â”€â”€ research/        # ë¦¬ì„œì¹˜ ê²°ê³¼"
    exit 1
}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì¸ì í™•ì¸
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if [[ $# -lt 1 ]]; then
    usage
fi

PROJECT_NAME="$1"
PROJECT_DIR="${PROJECTS_DIR}/${PROJECT_NAME}"

# í”„ë¡œì íŠ¸ ì´ë¦„ ê²€ì¦
if [[ ! "$PROJECT_NAME" =~ ^[a-zA-Z_][a-zA-Z0-9_]*$ ]]; then
    echo "ERROR: í”„ë¡œì íŠ¸ ì´ë¦„ì€ ì˜ë¬¸, ìˆ«ì, ì–¸ë”ìŠ¤ì½”ì–´ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤." >&2
    exit 1
fi

# ê¸°ì¡´ í”„ë¡œì íŠ¸ í™•ì¸
if [[ -d "$PROJECT_DIR" ]]; then
    echo "ERROR: í”„ë¡œì íŠ¸ê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤: $PROJECT_DIR" >&2
    exit 1
fi

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±: $PROJECT_NAME"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ë””ë ‰í† ë¦¬ ìƒì„±
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo "ğŸ“ ë””ë ‰í† ë¦¬ ìƒì„±..."
mkdir -p "${PROJECT_DIR}/prompts/writer"
mkdir -p "${PROJECT_DIR}/prompts/evaluator"
mkdir -p "${PROJECT_DIR}/prompts/research"
mkdir -p "${PROJECT_DIR}/outputs"
mkdir -p "${PROJECT_DIR}/research"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# config.sh ìƒì„±
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo "ğŸ“„ config.sh ìƒì„±..."
DATE=$(date +%Y-%m-%d)

cat > "${PROJECT_DIR}/config.sh" << 'CONFIGEOF'
#!/bin/bash
# config.sh - í”„ë¡œì íŠ¸ ì„¤ì •
CONFIGEOF

sed -e "s/{PROJECT_NAME}/${PROJECT_NAME}/g" \
    -e "s/{DATE}/${DATE}/g" \
    "${TEMPLATES_DIR}/config.template.sh" >> "${PROJECT_DIR}/config.sh"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# flow.yaml ìƒì„±
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo "ğŸ“„ flow.yaml ìƒì„±..."
sed "s/{PROJECT_NAME}/${PROJECT_NAME}/g" \
    "${TEMPLATES_DIR}/flow.template.yaml" > "${PROJECT_DIR}/flow.yaml"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# run.sh ìƒì„±
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo "ğŸ“„ run.sh ìƒì„±..."
cat > "${PROJECT_DIR}/run.sh" << 'RUNEOF'
#!/bin/bash
# run.sh - í”„ë¡œì íŠ¸ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
export PROJECT_DIR="$SCRIPT_DIR"

# ì„¤ì • ë¡œë“œ
source "${PROJECT_DIR}/config.sh"

# ê³µìš© ëª¨ë“ˆ ë¡œë“œ
load_core

# Flow ì‹¤í–‰
flow_run "$@"
RUNEOF

chmod +x "${PROJECT_DIR}/run.sh"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ê¸°ë³¸ í”„ë¡¬í”„íŠ¸ íŒŒì¼ ìƒì„±
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo "ğŸ“„ ê¸°ë³¸ í”„ë¡¬í”„íŠ¸ íŒŒì¼ ìƒì„±..."

# Writer í”„ë¡¬í”„íŠ¸
cat > "${PROJECT_DIR}/prompts/writer/main.md" << 'WRITEREOF'
---
name: writer_main
version: 1
description: "ê¸°ë³¸ ì‘ì„± í”„ë¡¬í”„íŠ¸"
---

# ì‘ì„± ìš”ì²­

## ì£¼ì œ
{topic}

## ì„¹ì…˜
{section_name}

## ë¶„ëŸ‰
{pages}í˜ì´ì§€

## ìš”êµ¬ì‚¬í•­
- êµ¬ì²´ì ì´ê³  ëª…í™•í•œ ë‚´ìš© ì‘ì„±
- ì¶œì²˜ê°€ í•„ìš”í•œ ìˆ˜ì¹˜ëŠ” ë°˜ë“œì‹œ ì¶œì²˜ ëª…ì‹œ
- ë…¼ë¦¬ì ì¸ íë¦„ ìœ ì§€

---

ìœ„ ì¡°ê±´ì— ë§ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”.
WRITEREOF

# Evaluator í”„ë¡¬í”„íŠ¸
cat > "${PROJECT_DIR}/prompts/evaluator/main.md" << 'EVALEOF'
---
name: evaluator_main
version: 1
description: "ê¸°ë³¸ í‰ê°€ í”„ë¡¬í”„íŠ¸"
---

# í‰ê°€ ìš”ì²­

ì•„ë˜ ë‚´ìš©ì„ í‰ê°€í•´ì£¼ì„¸ìš”.

## í‰ê°€ ê¸°ì¤€
1. ì™„ì„±ë„ (20ì )
2. êµ¬ì²´ì„± (20ì )
3. ë…¼ë¦¬ì„± (20ì )
4. ì •í™•ì„± (20ì )
5. í˜•ì‹ (20ì )

## í‰ê°€ ëŒ€ìƒ
{content}

---

## ì¶œë ¥ í˜•ì‹

```json
{
  "total_score": 0,
  "scores_by_criteria": {
    "ì™„ì„±ë„": 0,
    "êµ¬ì²´ì„±": 0,
    "ë…¼ë¦¬ì„±": 0,
    "ì •í™•ì„±": 0,
    "í˜•ì‹": 0
  },
  "strengths": ["ê°•ì 1", "ê°•ì 2"],
  "weaknesses": [
    {"issue": "ë¬¸ì œì ", "fix": "ê°œì„ ë°©ì•ˆ"}
  ],
  "priority_fix": "ìµœìš°ì„  ê°œì„ ì‚¬í•­"
}
```
EVALEOF

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# CLAUDE.md ìƒì„±
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo "ğŸ“„ CLAUDE.md ìƒì„±..."
cat > "${PROJECT_DIR}/CLAUDE.md" << CLAUDEEOF
# ${PROJECT_NAME} í”„ë¡œì íŠ¸

## ê°œìš”
í”„ë¡œì íŠ¸ ì„¤ëª…ì„ ì—¬ê¸°ì— ì‘ì„±í•˜ì„¸ìš”.

## ì‹¤í–‰ ë°©ë²•

\`\`\`bash
cd projects/${PROJECT_NAME}
./run.sh
\`\`\`

## íŒŒì¼ êµ¬ì¡°

- \`config.sh\` - í”„ë¡œì íŠ¸ ì„¤ì •
- \`flow.yaml\` - ì›Œí¬í”Œë¡œìš° ì •ì˜
- \`prompts/\` - í”„ë¡¬í”„íŠ¸ íŒŒì¼
- \`outputs/\` - ìƒì„±ëœ ê²°ê³¼ë¬¼
- \`research/\` - ë¦¬ì„œì¹˜ ê²°ê³¼

## ì›Œí¬í”Œë¡œìš° ìˆ˜ì •

\`flow.yaml\`ì„ í¸ì§‘í•˜ì—¬ ì›Œí¬í”Œë¡œìš°ë¥¼ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆí•˜ì„¸ìš”.
CLAUDEEOF

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ì™„ë£Œ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo ""
echo "âœ… í”„ë¡œì íŠ¸ ìƒì„± ì™„ë£Œ!"
echo ""
echo "ìƒì„±ëœ íŒŒì¼:"
find "${PROJECT_DIR}" -type f | sed "s|${PROJECT_DIR}/|  |"
echo ""
echo "ë‹¤ìŒ ë‹¨ê³„:"
echo "  1. ${PROJECT_DIR}/flow.yaml í¸ì§‘ (ì›Œí¬í”Œë¡œìš° ì •ì˜)"
echo "  2. ${PROJECT_DIR}/prompts/ í”„ë¡¬í”„íŠ¸ ì‘ì„±"
echo "  3. ./run.sh ì‹¤í–‰"
echo ""
echo "ì‹¤í–‰:"
echo "  cd ${PROJECT_DIR}"
echo "  ./run.sh"
